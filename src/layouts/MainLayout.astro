---
import HTMLHeader from "@components/core/HTMLHeader.astro";
import "../main.css";
import Navbar from "@components/navbar/Navbar.astro";
import { ViewTransitions } from "astro:transitions";

interface Props {
  showNav?: boolean;
  removeBodyPaddingTop?: boolean;
}

const { showNav = true, removeBodyPaddingTop = false } = Astro.props;

const currentPath = Astro.url.pathname;
const isPathIndex = currentPath === "/";
const setBodyPaddingTop = removeBodyPaddingTop ? "pt-0" : "pt-40 sm:pt-36";
const bodyClassList = `relative min-h-screen ${setBodyPaddingTop} bg-white-100 dark:bg-black-100 overflow-x-hidden`;
const indexBodyClassList = "polka-dots-bg" + " " + bodyClassList;
---

<style>
  .polka-dots-bg {
    background-image: radial-gradient(
      var(--black10) 1px,
      var(--primary_white) 1px
    );
    background-size: 20px 20px;
  }

  @media (prefers-color-scheme: dark) {
    .polka-dots-bg {
      background-image: radial-gradient(
        var(--white10) 1px,
        var(--primary_black) 1px
      );
    }
  }
</style>
<html lang="en">
  <head>
    <HTMLHeader />
    <!-- View transitions -->
    <ViewTransitions />
  </head>
  <body class={isPathIndex ? indexBodyClassList : bodyClassList}>
    {showNav && <Navbar />}
    <slot />

    <!-- Animate On Scroll CDN -->
    <script is:inline src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script is:inline>
    AOS.init();
    </script>
    <!-- Close menu after each transition or route change -->
    <script>
      import { OffScreenCanvas, header, wrapper } from "@scripts/constants";

      const closeMenuOnNavigation = () => {
        wrapper!.classList.remove("active");
        OffScreenCanvas!.classList.remove("active");
        header!.classList.remove("menu_active");
      };

      document.addEventListener("astro:after-swap", closeMenuOnNavigation);
    </script>
    <script define:vars={{ isPathIndex }}>
    onbeforeunload = () => {
      if (isPathIndex) sessionStorage.clear();
    };
    </script>
    <script>
      document.addEventListener("astro:after-swap", () => {
        const curtain = document.querySelector(".curtain");
        const loader = sessionStorage.getItem("preloader");

        if (loader !== null) {
          curtain?.remove();
        }
      });
    </script>
  </body>
</html>
